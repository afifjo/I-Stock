{% extends "base.html" %}
{% block title %}Recherche{% endblock %}

{% block content %}

<h1 class="text-3xl font-bold text-lightSkyBlue mb-8">Rechercher des articles</h1>

<!-- Formulaire de recherche -->
<form method="get" action="{{ url_for('main.search') }}" class="flex gap-4">
    <input name="q" value="{{ q or '' }}" placeholder="Rechercher un article par nom..."
        class="flex-1 px-4 py-3 rounded border border-gray-300 focus:ring focus:border-blue-500">
    <button class="px-6 py-3 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700">
        Rechercher
    </button>
</form>

<!-- Layout Grid -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">

    <!-- Colonne gauche : résultats -->
    <div class="md:col-span-2">

        {% if q is none %}
        <!-- Aucune recherche effectuée -->
        <p class="text-gray-500 text-lg mt-10">
            Saisissez un terme ci-dessus pour lancer une recherche.
        </p>

        {% else %}

        {% if items.items %}
        <!-- Résultats trouvés -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">

            {% for item in items.items %}
            <div class="p-6 bg-white rounded-xl shadow">

                <h3 class="font-semibold text-xl mb-1">
                    <a href="{{ url_for('main.view', item_id=item.id) }}" class="text-blue-600 hover:underline">
                        {{ item.name }}
                    </a>
                </h3>

                <!-- FIXED DESCRIPTION CLAMP -->
                <p class="text-gray-600 text-sm overflow-hidden text-ellipsis whitespace-normal"
                    style="display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; max-width:100%;">
                    {{ item.description }}
                </p>

                <div class="mt-3">
                    <p class="text-gray-700">
                        Quantité : <strong>{{ item.quantity }}</strong>
                    </p>
                </div>

            </div>
            {% endfor %}

        </div>

        <!-- Pagination -->
        <div class="flex justify-center items-center gap-4 mt-8 text-gray-700">
            {% if items.has_prev %}
            <a href="{{ url_for('main.search', q=q, page=items.prev_num) }}" class="hover:underline">
                Précédent
            </a>
            {% else %}
            <span class="text-gray-400">Précédent</span>
            {% endif %}

            <span>Page {{ items.page }} / {{ items.pages }}</span>

            {% if items.has_next %}
            <a href="{{ url_for('main.search', q=q, page=items.next_num) }}" class="hover:underline">
                Suivant
            </a>
            {% else %}
            <span class="text-gray-400">Suivant</span>
            {% endif %}
        </div>

        {% else %}

        <!-- Aucun résultat -->
        <div class="p-6 bg-white rounded-xl shadow text-gray-600 mt-6">
            Aucun résultat trouvé pour <strong>{{ q }}</strong>.
        </div>

        {% endif %}
        {% endif %}

    </div>

    <!-- Colonne droite : conseils -->
    <aside>
        <div class="p-6 bg-white rounded-xl shadow">
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Conseils de recherche</h3>
            <p class="text-gray-600 text-sm leading-relaxed">
                • Utilisez des mots-clés simples.<br>
                • Les correspondances partielles sont prises en charge.<br>
                • Évitez les phrases longues — préférez des noms d'articles courts.<br>
                • La recherche n'est pas sensible à la casse.
            </p>
        </div>
    </aside>

</div>

{% endblock %}